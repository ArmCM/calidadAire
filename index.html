<!DOCTYPE html>
<html lang="en">
<head>
  <title>Calidad del Aire</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="import" href="https://cdn.datos.gob.mx/bower_components/dgm-navbar/dgm-navbar.html">
  <link rel="import" href="https://cdn.datos.gob.mx/bower_components/dgm-footer/dgm-footer.html">
  <link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.1.0/dist/leaflet.css"
   integrity="sha512-wcw6ts8Anuw10Mzh9Ytw4pylW8+NAD4ch3lqm9lzAsTxg0GFeJgoAtxuCLREZSC5lUXdVyo/7yfsqFjQ4S+aKw=="
   crossorigin=""/>

  <!-- owl carousel  -->
  <link rel="stylesheet" href="libs/owlcarousel/owl.carousel.min.css">
  <link rel="stylesheet" href="libs/owlcarousel/owl.theme.default.min.css">
<style>

.chart-gauge
{
width: 400px;
margin: 32px 0 0 0;
}

.chart-first
{
fill: #9FBD35;
}

.chart-second
{
fill:url(#grad1);
}

.chart-third
{
  fill: #FB3033;
}

.chart-blanco
{
  fill: #FFFFFF;
}

.needle, .needle-center
{
fill: #ffffff;
}
.text {
    color: "#ffffff";
    font-size: 16px;
}

svg {
font: 10px sans-serif;
}

.parallax img{
filter: contrast(100%) brightness(70%);
}

.input-field label{
  color: #fff !important;
}

#mapid { height: 800px; }

	.s5ths,
	.m5ths,
	.l5ths,
	.xl5ths {
	  margin-left: auto;
	  left: auto;
	  right: auto;
	}

	.row .col.s5ths {
	  width: 20%;
	}

	@media only screen and (min-width: 601px) {
	  .row .col.m5ths {
	    width: 20%;
	  }
	}

	@media only screen and (min-width: 993px) {
	  .row .col.l5ths {
	    width: 20%;
	  }
}

@media only screen and (min-width: 1201px) {
  .row .col.xl5ths {
    width: 20%;
  }
}

</style>

</head>
<body class="front" cz-shortcut-listen="true" >
  <nav style="background-color:#393c3e; color:#fff;">
    <div class="nav-wrapper">
      <a href="#!" class="brand-logo">gob.mx</a>
      <a href="#" data-activates="mobile-demo" class="button-collapse"><i class="material-icons">gob.mx</i></a>
      <ul class="right hide-on-med-and-down">
        <li><a href="sass.html">Tramites</a></li>
        <li><a href="badges.html">Gobierno</a></li>
        <li><a href="collapsible.html">Participa</a></li>
        <li><a href="mobile.html">Datos</a></li>
        <li>
          <div class="nav-wrapper">
             <form>
               <div class="input-field">
                 <input id="search" type="search" required>
                 <label class="label-icon" for="search"><i class="material-icons">search</i></label>
                 <i class="material-icons">close</i>
               </div>
             </form>
           </div>
        </li>
      </ul>
      <ul class="side-nav" id="mobile-demo">
        <li><a href="sass.html">Trámites</a></li>
        <li><a href="badges.html">Gobierno</a></li>
        <li><a href="collapsible.html">Participa</a></li>
        <li><a href="mobile.html">Datos</a></li>
      </ul>
    </div>
  </nav>

  <div id="" class="cabezera" style="background-image: url('foto_fondo.png');background-size: cover; background-repeat: no-repeat;background-position:center top;">
    <div class="section no-pad-bot">
      <div class="container">
        <div class="row center">
          <div class="col s12 m12 l12 margen_arriba_g">
            <h2 class="header center white-text text-lighten-2">Calidad de Aire MX</h2>
          </div>
          <div class="col s10 m10 l10  offset-s1 offset-m1 offset-l1">
            <h5 class="header col s12 white-text text-lighten-2" style="   font-size: 32px;font-weight: 100;letter-spacing: 1px; line-height: inherit;">*Concentraciones de PM10 medidas en microgramos de partículas por metro cúbico de aire (µg/m3)</h5>
          </div>
        </div>

        <div class="row center">
          <div class="col s4 m4 l4  offset-s4 offset-m4 offset-l4">
            <div class="nav-wrapper">
               <form>
                 <div class="input-field">
                   <input id="search_central" type="search" required style="border-bottom: 1px solid #f1f5fb;">
                   <label class="label-icon" for="search_central"><i class="material-icons" style="color: #ffff;">search</i></label>
                   <i class="material-icons">close</i>
                 </div>
               </form>
             </div>
          </div>
        </div>

        <div class="row center">
          <div class="col s12 margen_arriba_g">
            <div class="base_botones">
              <a href="#" id="btn_ciudades" class="boton boton_activo">Top 3 Ciudades</a>
              <a href="#" id="btn_estados" class="boton boton_inactivo">32 Estados</a>
            </div>
          </div>
        </div>

        <div class="row center velocimetros">
          <div class="col s12 m12 l4">
            <div class="col s12 ">
              <h5>Ciudad de México</h5>
            </div>
            <div class="col s12 cont_carrucel">
              <div class="col s1 offset-s1">
                <p class="customPrevBtn"> < </p>
              </div>
              <div class="col s8">
                <div class="owl-carousel owl-theme">
                  <div class="item"><p>PM10</p></div>
                  <div class="item"><p>PM2.5</p></div>
                  <div class="item"><p>S02</p></div>
                  <div class="item"><p>DV</p></div>
                </div>
              </div>
              <div class="col s1">
                <p class="customNextBtn"> > </p>
              </div>
            </div>
            <div class="col s12 center">
              <div class="chart-gauge"></div>
              <p>
               <span class="linecustom">10,8,9,3,5,8,5,7</span>
              </p>
              <a href="" class="boton_redondo">Ver más</a>
            </div>
          </div>

          <div class="col s12 m12 l4">
            <div class="col s12">
              <h5>Puebla</h5>
            </div>
            <div class="col s12 cont_carrucel">
              <div class="col s1 offset-s1">
                <p class="customPrevBtn"> < </p>
              </div>
              <div class="col s8">
                <div class="owl-carousel owl-theme">
                  <div class="item"><p>PM10</p></div>
                  <div class="item"><p>PM2.5</p></div>
                  <div class="item"><p>S02</p></div>
                  <div class="item"><p>DV</p></div>
                </div>
              </div>
              <div class="col s1">
                <p class="customNextBtn"> > </p>
              </div>
            </div>
            <div class="col s12">
              <div class="chart-gauge"></div>
              <p>
               <span class="linecustom">10,8,9,3,5,8,5,7</span>
              </p>
              <a href="" class="boton_redondo">Ver más</a>
            </div>
          </div>
          <div class="col s12 m12 l4">
            <div class="col s12">
              <h5>Guadalajara</h5>
            </div>
            <div class="col s12 cont_carrucel">
              <div class="col s1 offset-s1">
                <p class="customPrevBtn"> < </p>
              </div>
              <div class="col s8">
                <div class="owl-carousel owl-theme">
                  <div class="item"><p>PM10</p></div>
                  <div class="item"><p>PM2.5</p></div>
                  <div class="item"><p>S02</p></div>
                  <div class="item"><p>DV</p></div>
                </div>
              </div>
              <div class="col s1">
                <p class="customNextBtn"> > </p>
              </div>
            </div>
            <div class="col s12">
              <div class="chart-gauge"></div>
              <p>
               <span class="linecustom">10,8,9,3,5,8,5,7</span>
              </p>
              <a href="" class="boton_redondo">Ver más</a>
            </div>
          </div>
        </div>

      </div>

    </div>
  </div>

  <div class="row seccion_mapa">
    <div class="col s12 botonera_mapa">
      <div class="input-field col s6 m2 l2">
        <select  name="estados" id="estados">
          <option value="0" disabled selected>Entidad Federativa</option>
          <option value="1">México</option>
          <option value="2">Puebla</option>
          <option value="3">Guadalajara</option>
        </select>
      </div>
      <div class="input-field col s6 m2 l2">
        <select  name="municipios" id="municipios">
          <option value="0" disabled selected>Municipios</option>
          <option value="0">Municipios 1</option>
          <option value="0">Municipios 2</option>
          <option value="0">Municipios 3</option>
        </select>
      </div>
      <div class="input-field col s6 m2 l2">
        <form action="#">
          <p class="range-field">
            <input type="range" id="test5" min="0" max="100" />
          </p>
        </form>
      </div>
    </div>
    <div class="col s12">
      <div id="mapid"></div>
    </div>
  </div>

  <div class="row detalle">
    <div class="row">
      <div class="col s4">
        <p class="titulo"><strong>Ciudad Fernández</strong></p>
        <p class="subtitulo">Calidad de aire: Mala22</p>
      </div>
      <div class="col s3">
        <div class="row">
          <div class="col s6">
            <img src="imagenes/fecha.png">
          </div>
          <div class="col s6">
            <p><b>Fecha</b></p>
            <p>24/05/17</p>
          </div>
        </div>
        <div class="row">
          <div class="col s6">
            <img src="imagenes/temperatura.png">
          </div>
          <div class="col s6">
            <p><b>Temperatura</b></p>
            <p>20º C</p>
          </div>
        </div>
        <div class="row">
          <div class="col s6">
            <img src="imagenes/contaminante.png">
          </div>
          <div class="col s6">
            <p><b>Contaminante:</b></p>
            <p>PM10, 104</p>
          </div>
        </div>
        <div class="row">
          <div class="col s6">
            <img src="imagenes/estacion.png">
          </div>
          <div class="col s6">
            <p><b>Estación:</b></p>
            <p>XAL-Xalostoc</p>
          </div>
        </div>
      </div>
      <div class="col s4">
        <img class="responsive-img" src="imagenes/mapa.png">
      </div>
    </div>
    <div class="row">
      <div class="col s12 ">
        <p class="subtitulo_chico">Parámetros de la red</p>
      </div>
      <div class="col s5ths">
        <p class="etiqueta">CO</p>
        <p class="contenido">2652.07</p>
      </div>
      <div class="col s5ths">
        <p class="etiqueta">NO</p>
        <p class="contenido">456.07</p>
      </div>
      <div class="col s5ths">
        <p class="etiqueta">N02</p>
        <p class="contenido">2652.07</p>
      </div>
      <div class="col s5ths">
        <p class="etiqueta">NOx</p>
        <p class="contenido">456.07</p>
      </div>
      <div class="col s5ths">
        <p class="etiqueta">O3</p>
        <p class="contenido">2652.07</p>
      </div>
      <div class="col s5ths">
        <p class="etiqueta">VV</p>
        <p class="contenido">456.07</p>
      </div>
      <div class="col s5ths">
        <p class="etiqueta">VV</p>
        <p class="contenido">456.07</p>
      </div>
      <div class="col s5ths">
        <p class="etiqueta">PM10</p>
        <p class="contenido">2652.07</p>
      </div>
      <div class="col s5ths">
        <p class="etiqueta">PM2.5</p>
        <p class="contenido">456.07</p>
      </div>
      <div class="col s5ths">
        <p class="etiqueta">S02</p>
        <p class="contenido">2652.07</p>
      </div>
      <div class="col s5ths">
        <p class="etiqueta">DV</p>
        <p class="contenido">456.07</p>
      </div>
      <div class="col s5ths">
        <p class="etiqueta">HR</p>
        <p class="contenido">456.07</p>
      </div>
      <div class="col s5ths">
        <p class="etiqueta">PB</p>
        <p class="contenido">2652.07</p>
      </div>
      <div class="col s5ths">
        <p class="etiqueta">PP</p>
        <p class="contenido">456.07</p>
      </div>
      <div class="col s5ths">
        <p class="etiqueta">RS</p>
        <p class="contenido">2652.07</p>
      </div>
    </div>
    <div class="row">
      <div class="col s12">
        <canvas id="myChart"></canvas>
      </div>
    </div>
  </div>







  <footer class="page-footer black">
    <div class="container">
      <div class="row">
        <div class="col l6 s12">
          <h5 class="white-text">datos.gob.mx</h5>
        </div>
        <div class="col l3 s12">

        </div>
        <div class="col l3 s12">
          <ul>
            <li><a class="white-text" href="#!">Datos</a></li>
            <li><a class="white-text" href="#!">Herramientas</a></li>
            <li><a class="white-text" href="#!">Blog</a></li>
            <li><a class="white-text" href="#!">Guía</a></li>
            <li><a class="white-text" href="#!">Consejo Consultivo</a></li>
            <li><a class="white-text" href="#!">Adela</a></li>
            <li><a class="white-text" href="#!">Acerca</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-copyright">
      <div class="container">
      LIBRE USO MX
      </div>
    </div>
  </footer>
  <!-- <p>
  Sparkline with dynamic data: <span class="dynamicsparkline">Loading..</span>
  </p> -->
  <!--  Scripts-->
  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="js/materialize.js"></script>
  <script src="js/init.js"></script>
  <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <!-- Leaflet-->
  <script src="https://unpkg.com/leaflet@1.1.0/dist/leaflet.js"
    integrity="sha512-mNqn2Wg7tSToJhvHcqfzLMU6J4mkOImSPTxVZAdo+lcPlk+GhZmYgACEe0x35K7YzW1zJ7XyJV/TT1MrdXvMcA=="
    crossorigin=""></script>
  <script src="libs/owlcarousel/owl.carousel.min.js"></script>
  <script type="text/javascript" src="libs/jquery.sparkline.min.js"></script>
  <script src="libs/chartjs/Chart.bundle.js"></script>
	<script src="libs/chartjs/utils.js"></script>

  <!-- local-->
  <script src="js/scripts.js" charset="utf-8"></script>
<style media="screen">

canvas{
    -moz-user-select: none;
    -webkit-user-select: none;
    -ms-user-select: none;
  }

  .chartjs-tooltip {
    opacity: 1;
    position: absolute;
    background: rgba(0, 0, 0, .7);
    color: white;
    border-radius: 3px;
    -webkit-transition: all .1s ease;
    transition: all .1s ease;
    pointer-events: none;
    -webkit-transform: translate(-50%, 0);
    transform: translate(-50%, 0);
    padding: 4px;
  }

  .chartjs-tooltip-key {
    display: inline-block;
    width: 10px;
    height: 10px;
  }
</style>
<script>
  $(function() {
        /** This code runs when everything has been loaded on the page */
        /* Inline sparklines take their values from the contents of the tag */
        $('.inlinesparkline').sparkline();

        /* Sparklines can also take their values from the first argument
        passed to the sparkline() function */
        var myvalues = [10,8,5,7,4,4,1];
        $('.dynamicsparkline').sparkline(myvalues);

        // Customized line chart
        $('.linecustom').sparkline('html',
        {
          height: '1.5em', width: '8em', lineColor: '#fff', fillColor: '#a4b6da',
          minSpotColor: false, maxSpotColor: false, spotColor: '#fff', spotRadius: 3
        });

        var ctx = document.getElementById('myChart').getContext('2d');
        var color = Chart.helpers.color;
        var chart = new Chart(ctx, {
            // The type of chart we want to create
            type: 'line',

            // The data for our dataset
            data: {
                labels: ["January", "February", "March", "April", "May", "June", "July"],
                datasets: [{
                    label: "Contaminantes",
                    // backgroundColor: 'rgb(255, 99, 132)',
                    // borderColor: 'rgb(0, 156, 242)',

                    backgroundColor: color(window.chartColors.blue).alpha(0.2).rgbString(),
                    borderColor: window.chartColors.blue,
                    pointBackgroundColor: window.chartColors.blue,
                    data: [0, 10, 5, 2, 20, 30, 45],
                }]
            },

            // Configuration options go here
            options: {}
        });
    });

  </script>

  <!-- <script type="text/javascript" src="./gaugeClient.js"></script>
		<script type="text/javascript" src="./labels.js"></script> -->
        <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
        <script type="text/javascript">
        var estaciones = [];
        var temporale = [];
        var avg = 0;
        var totalt = 0;

        $.ajax({
          type: 'GET',
          url: "https://api.datos.gob.mx/v1/sinaica?city=Pachuca&fecha=2017-06-29",
          data: {},
          success: function( data, textStatus, jqxhr ) {

            console.log('DATA');
            console.log(data.results);

            //for (var i = 0; i < data.results.length; i++) {

              //estaciones.push(data.results.stations[i].id);
              if(data.results[0]._id != "cve"){
                var contaminante = data.results[0].parametro;

                  if (contaminante == 'PM10'){
                    estaciones.push(parseFloat(data.results[0].valororig));
                  }

              }

            //}

            // for(var k = 0 ; k < estaciones.length; k++) {
            //     totalt += estaciones[k];
            // }
            console.log('PM10');
            console.log(contaminante);
            console.log('Total');
            console.log(data.results[0].valororig);
            //console.log(estaciones.length);
            //avg = totalt / estaciones.length;
            avg = data.results[0].valororig;
            console.log(avg);

            $('.contador').html(avg.toFixed(2));

          },
          xhrFields: {
            withCredentials: false
          },
          crossDomain: true,
          async:false
        });


    var name = "Calidad del Aire";

    var value = avg;


    var gaugeMaxValue = 100;

    var gaugeMaxValue2 = '.';


    // données à calculer
    var percentValue = value / gaugeMaxValue;


    ////////////////////////

    var needleClient;
    var needleClient2;



    (function(){

      var barWidth, chart, chartInset, degToRad, repaintGauge,
      height, margin, numSections, padRad, percToDeg, percToRad,
      percent, radius, sectionIndx, svg, totalPercent, width,
      valueText,valueTexto, formatValue, k;

      percent = percentValue;

      numSections = 1;
      sectionPerc = 1 / numSections / 2;
      padRad = 0.001;
      chartInset = 10;

      // Orientation of gauge:
      totalPercent = .75;

      el = d3.select('.chart-gauge');
      el1 = d3.select('.chart-gauge1');
      el2 = d3.select('.chart-gauge2');

      margin = {
        top: 30,
        right: 30,
        bottom: 30,
        left: 30
      };

      width = el[0][0].offsetWidth - margin.left - margin.right;
      widtho = el[0][0].offsetWidth - margin.left + 25 - margin.right + 25;
      height = width;
      heighto = widtho;
      radius = Math.min(width, height) / 2;
      radiuso = Math.min(widtho+10,heighto+10) / 2
      barWidth = 3 * width / 150;

      barWidtho = 1 * widtho / 150;



      //Utility methods

      percToDeg = function(perc) {
        return perc * 360;
      };

      percToRad = function(perc) {
        return degToRad(percToDeg(perc));
      };

      degToRad = function(deg) {
        return deg * Math.PI / 180;
      };

      // Create SVG element
      //svg = el.append('svg').attr('width', width + margin.left + margin.right).attr('height', height + margin.top + margin.bottom);
      svg = el.append('svg').attr('width', width + margin.left + margin.right).attr('height', '220');

      // Add layer for the panel
      chort = svg.append('defs').append('linearGradient').attr('id','grad1').attr('x1','0%').attr('y1','100%').attr('x2','100%').attr('y2','0%');
      chort.append('stop').attr('offset','0%').attr('style','stop-color:#9FBD35;stop-opacity:1;');
      chort.append('stop').attr('offset','100%').attr('style','stop-color:#FB3033;stop-opacity:1;');

      chart = svg.append('g').attr('transform', "translate(" + ((width) / 2 + margin.left) + ", " + ((height + margin.top +40) / 2) + ")");

      chart.append('path').attr('class', "arc chart-first");
      chart.append('path').attr('class', "arc chart-second");
      chart.append('path').attr('class', "arc chart-third");
      chart.append('path').attr('class', "arc chart-blanco");
      chart.append('path').attr('id', "arc");
      // chart.append('path').attr('class', "arc chart-fourth");
      // chart.append('path').attr('class', "arc chart-fifth");

    valueTexto = chart.append("text")
          .attr('id', "Valueo")
          .attr("font-size",72)
          .attr("text-anchor","middle")
          .attr("dy",".5em")
          .style("fill", '#ffffff');

    valueText = chart.append("text")
          .attr('id', "Value")
          .attr("font-size",16)
          .attr("text-anchor","middle")
          .attr("dy",".5em")
          .style("fill", '#000000');
          //formatValue = d3.format('1%');
          formatValue = d3.format(".2f");

          // arc5 = d3.svg.arc().outerRadius(radius - chartInset).innerRadius(radius - chartInset - barWidth)
          blanco = d3.svg.arc().outerRadius(radiuso).innerRadius(radiuso - barWidtho)
          arc3 = d3.svg.arc().outerRadius(radius - chartInset).innerRadius(radius - chartInset - barWidth)
          arc2 = d3.svg.arc().outerRadius(radius - chartInset).innerRadius(radius - chartInset - barWidth)
          arc1 = d3.svg.arc().outerRadius(radius - chartInset).innerRadius(radius - chartInset - barWidth)

          repaintGauge = function ()
          {
            perc = 0.5;
            var next_start = totalPercent;
            var next_starto = totalPercent;


            arcStartRad = percToRad(next_start);
            arcEndRad = arcStartRad + percToRad(perc / 1);
            next_starto = perc / 1;

            blanco.startAngle(arcStartRad).endAngle(arcEndRad);

            arcStartRad = percToRad(next_start);
            arcEndRad = arcStartRad + percToRad(perc / 3);
            next_start += perc / 3;

            arc1.startAngle(arcStartRad).endAngle(arcEndRad);

            arcStartRad = percToRad(next_start);
            arcEndRad = arcStartRad + percToRad(perc / 3);
            next_start += perc / 3;

            arc2.startAngle(arcStartRad + padRad).endAngle(arcEndRad);

            arcStartRad = percToRad(next_start);
            arcEndRad = arcStartRad + percToRad(perc / 3);
            next_start += perc / 3;

            arc3.startAngle(arcStartRad + padRad).endAngle(arcEndRad);


            // arcStartRad = percToRad(next_start);
            // arcEndRad = arcStartRad + percToRad(perc / 5);
            // next_start += perc / 5;
            //
            // arc4.startAngle(arcStartRad + padRad).endAngle(arcEndRad);
            //
            // arcStartRad = percToRad(next_start);
            // arcEndRad = arcStartRad + percToRad(perc / 5);
            //
            // arc5.startAngle(arcStartRad + padRad).endAngle(arcEndRad);

            chart.select(".chart-first").attr('d', arc1);
            chart.select(".chart-second").attr('d', arc2);
            chart.select(".chart-third").attr('d', arc3);
            chart.select(".chart-blanco").attr('d', blanco);
            // chart.select(".chart-fifth").attr('d', arc5);

          }
          /////////

          var dataset = [{metric:name, value: value}]

          var texts = svg.selectAll("text")
            .data(dataset)
            .enter();

      texts.append("text")
           .text(function(){
                return dataset[0].metric;
           })
           .attr('id', "Name")
           .attr('transform', "translate(" + ((width + margin.left) / 6) + ", " + ((height + margin.top) / 1.5) + ")")
           .attr("font-size",25)
           .style("fill", "#000000");


      texts.append("text")
          .text(function(){
              return 0;
          })
          .attr('id', 'scale0')
          .attr('transform', "translate(" + ((width + margin.left) / 100 ) + ", " + ((height + margin.top) / 2) + ")")
          .attr("font-size", 15)
          .style("fill", "#000000");

      texts.append("text")
          .text(function(){
              return gaugeMaxValue/2;
          })
          .attr('id', 'scale10')
          .attr('transform', "translate(" + ((width + margin.left) / 2.15 ) + ", " + ((height + margin.top) / 30) + ")")
          .attr("font-size", 15)
          .style("fill", "#000000");


      texts.append("text")
          .text(function(){
              return gaugeMaxValue;
          })
          .attr('id', 'scale20')
          .attr('transform', "translate(" + ((width + margin.left) / 1.03 ) + ", " + ((height + margin.top) / 2) + ")")
          .attr("font-size", 15)
          .style("fill", "#000000");

      texts.append("text")
          .text('.')
          .attr('id', 'scale30')
          .attr('transform', "translate(" + ((width + margin.left) / 1.03 ) + ", " + ((height + margin.top) / 2) + ")")
          .attr("font-size", 72)
          .style("fill", "#ffffff");


      var Needle = (function() {

      //Helper function that returns the `d` value for moving the needle
      var recalcPointerPos = function(perc) {
        var centerX, centerY, leftX, leftY, rightX, rightY, thetaRad, topX, topY;
        thetaRad = percToRad(perc / 2);
        centerX = 0;
        centerY = 0;
        topX = centerX - this.len * Math.cos(thetaRad);
        topY = centerY - this.len * Math.sin(thetaRad);
        leftX = centerX - this.radius * Math.cos(thetaRad - Math.PI / 2);
        leftY = centerY - this.radius * Math.sin(thetaRad - Math.PI / 2);
        rightX = centerX - this.radius * Math.cos(thetaRad + Math.PI / 2);
        rightY = centerY - this.radius * Math.sin(thetaRad + Math.PI / 2);

        return "M " + leftX + " " + leftY + " L " + topX + " " + topY + " L " + rightX + " " + rightY;
      };

      function Needle(el) {
        this.el = el;
        this.len = width / 2.5;
        this.radius = this.len / 13;
        this.radiuso = this.len / 18;
      }

      Needle.prototype.render = function() {
        this.el.append('circle').attr('class', 'needle-pointer').attr('cx', 0).attr('cy', 0).attr('r', this.radiuso);
        this.el.append('circle').attr('class', 'needle-center').attr('cx', 0).attr('cy', 0).attr('r', this.radius);
        return this.el.append('path').attr('class', 'needle').attr('id', 'client-needle').attr('d', recalcPointerPos.call(this, 0));
      };

  Needle.prototype.moveTo = function(perc) {
    var self,
        oldValue = this.perc || 0;

    this.perc = perc;
    self = this;

    // Reset pointer position
    this.el.transition().delay(100).ease('quad').duration(200).select('.needle').tween('reset-progress', function() {
      return function(percentOfPercent) {
        var progress = (1 - percentOfPercent) * oldValue;

        repaintGauge(progress);
        return d3.select(this).attr('d', recalcPointerPos.call(self, progress));
      };
    });

    this.el.transition().delay(300).ease('bounce').duration(1500).select('.needle').tween('progress', function() {
      return function(percentOfPercent) {
        var progress = percentOfPercent * perc;
        //var progress = perc;

        repaintGauge(progress);

        var thetaRad = percToRad(progress / 2);
        var textX = - (self.len + 45) * Math.cos(thetaRad);
        var textY = - (self.len + 45) * Math.sin(thetaRad);

        valueText.text(formatValue(progress))
          .attr('transform', "translate("+textX+","+textY+")")

          // valueTexto.text('.')
          //   .attr('transform', "translate("+textX+","+textY+")")

        return d3.select(this).attr('d', recalcPointerPos.call(self, progress));
      };
    });

  };


  return Needle;

  })();

  needle = new Needle(chart);
  needle.render();
  needle.moveTo(percent);

  })();



// +++++++++++++++++++++++++++++++++ mapa ++++++++++++++++++++++++++++
  var mymap = L.map('mapid').setView([19.432608, -99.133209], 5);

  var OpenStreetMap_BlackAndWhite = L.tileLayer('http://{s}.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png', {
  	maxZoom: 18,
  	attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
  }).addTo(mymap);
  
  // var OpenStreetMap_Mapnik = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  // 	maxZoom: 19,
  // 	attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
  // }).addTo(mymap);

	// L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
	// 	maxZoom: 18,
	// 	attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
	// 		'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
	// 		'Imagery © <a href="http://mapbox.com">Mapbox</a>',
	// 	id: 'mapbox.streets'
	// }).addTo(mymap);

  if( /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)){
    mymap.dragging.disable();
  }
  mymap.scrollWheelZoom.disable();



// +++++++++++++++++++++++++++++++++ fin mapa +++++++++++++++++++++++++



  </script>

  </body>
</html>
