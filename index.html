<!DOCTYPE html>
<html lang="en">
<head>
  <title>Calidad del Aire</title>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no"/>

  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="import" href="https://cdn.datos.gob.mx/bower_components/dgm-navbar/dgm-navbar.html">
  <link rel="import" href="https://cdn.datos.gob.mx/bower_components/dgm-footer/dgm-footer.html">
  <link href="css/materialize.css" type="text/css" rel="stylesheet" media="screen,projection"/>
  <link href="css/style.css" type="text/css" rel="stylesheet" media="screen,projection"/>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.1.0/dist/leaflet.css"
   integrity="sha512-wcw6ts8Anuw10Mzh9Ytw4pylW8+NAD4ch3lqm9lzAsTxg0GFeJgoAtxuCLREZSC5lUXdVyo/7yfsqFjQ4S+aKw=="
   crossorigin=""/>


<style>

.chart-gauge
{
width: 400px;
margin: 100px auto
}

.chart-first
{
fill: #9FBD35;
}

.chart-second
{
fill: #F2BA3A;
}

.chart-third
{
  fill: #FB3033;
}

.needle, .needle-center
{
fill: #000000;
}
.text {
    color: "#112864";
    font-size: 16px;
}

svg {
font: 10px sans-serif;
}

.parallax img{
filter: contrast(100%) brightness(70%);
}

.input-field label{
  color: #fff !important;
}

#mapid { height: 800px; }

	.s5ths,
	.m5ths,
	.l5ths,
	.xl5ths {
	  margin-left: auto;
	  left: auto;
	  right: auto;
	}

	.row .col.s5ths {
	  width: 20%;
	}

	@media only screen and (min-width: 601px) {
	  .row .col.m5ths {
	    width: 20%;
	  }
	}

	@media only screen and (min-width: 993px) {
	  .row .col.l5ths {
	    width: 20%;
	  }
}

@media only screen and (min-width: 1201px) {
  .row .col.xl5ths {
    width: 20%;
  }
}

</style>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>

<!-- Leaflet-->
<script src="https://unpkg.com/leaflet@1.1.0/dist/leaflet.js"
  integrity="sha512-mNqn2Wg7tSToJhvHcqfzLMU6J4mkOImSPTxVZAdo+lcPlk+GhZmYgACEe0x35K7YzW1zJ7XyJV/TT1MrdXvMcA=="
  crossorigin=""></script>

</head>
<body class="front" cz-shortcut-listen="true" >
  <nav style="background-color:#393c3e; color:#fff;">
    <div class="nav-wrapper">
      <a href="#!" class="brand-logo">gob.mx</a>
      <a href="#" data-activates="mobile-demo" class="button-collapse"><i class="material-icons">gob.mx</i></a>
      <ul class="right hide-on-med-and-down">
        <li><a href="sass.html">Tramites</a></li>
        <li><a href="badges.html">Gobierno</a></li>
        <li><a href="collapsible.html">Partisipa</a></li>
        <li><a href="mobile.html">Datos</a></li>
        <li>
          <div class="nav-wrapper">
             <form>
               <div class="input-field">
                 <input id="search" type="search" required>
                 <label class="label-icon" for="search"><i class="material-icons">search</i></label>
                 <i class="material-icons">close</i>
               </div>
             </form>
           </div>
        </li>
      </ul>
      <ul class="side-nav" id="mobile-demo">
        <li><a href="sass.html">Tramites</a></li>
        <li><a href="badges.html">Gobierno</a></li>
        <li><a href="collapsible.html">Partisipa</a></li>
        <li><a href="mobile.html">Datos</a></li>
      </ul>
    </div>
  </nav>

  <div id="" style="background-image: url('foto_fondo.png');background-size: cover; background-repeat: no-repeat;background-position:center top;">
    <div class="section no-pad-bot">
      <div class="container">

        <h2 class="header center white-text text-lighten-2">Calidad de Aire MX</h2>
        <div class="row center">
          <div class="col s10 m10 l10  offset-s1 offset-m1 offset-l1">
            <h5 class="header col s12 white-text text-lighten-2" style="   font-size: 32px;font-weight: 100;letter-spacing: 1px; line-height: inherit;">*Concentraciones de PM10 medidas en microgramos de partículas por metro cúbico de aire (µg/m3)</h5>
          </div>
        </div>
        <div class="row center">
          <div class="col s4 m4 l4  offset-s4 offset-m4 offset-l4">
            <div class="nav-wrapper">
               <form>
                 <div class="input-field">
                   <input id="search_central" type="search" required style="    border-bottom: 1px solid #f1f5fb;">
                   <label class="label-icon" for="search_central"><i class="material-icons" style="color: #ffff;">search</i></label>
                   <i class="material-icons">close</i>
                 </div>
               </form>
             </div>
          </div>
        </div>
        <div class="row center">
          <a href="#" id="download-button" class="btn-large waves-effect waves-light white teal-text lighten-1 ">Top 3 Ciudades</a>
          <a href="#" id="download-button" class="btn-large waves-effect waves-light teal lighten-1">32 estados</a>
        </div>

        <div class="row center">
          <div class="col s12 l4">
            <div class="chart-gauge"></div>
          </div>
          <div class="col s12 l4">
            <div class="chart-gauge1"></div>
          </div>
          <div class="col s12 l4">
            <div class="chart-gauge2"></div>
          </div>
        </div>

      </div>
    </div>
  </div>
  <div class="col s12">
    <div id="mapid"></div>
  </div>
  <div class="container">
    <div class="row">
      <div class="col s4 m4 l4">
        <p><strong>Ciudad Fernandez</strong></p>
        <p>Calidad de aire: Mala22</p>
      </div>
      <div class="col l3">
        <div class="row">
          <div class="col s6">
            <img src="imagenes/fecha.png">
          </div>
          <div class="col s6">
            <p><b>Fecha</b></p>
            <p>24/05/17</p>
          </div>
        </div>
        <div class="row">
        <div class="col s6">
          <img src="imagenes/temperatura.png">
        </div>
        <div class="col s6">
          <p><b>Temperatura</b></p>
          <p>20º C</p>
        </div>
        </div>
        <div class="row">
        <div class="col s6">
          <img src="imagenes/contaminante.png">
        </div>
        <div class="col s6">
          <p><b>contaminante:</b></p>
          <p>PM10, 104</p>
        </div>
        </div>
        <div class="row">
        <div class="col s6">
          <img src="imagenes/estacion.png">
        </div>
        <div class="col s6">
          <p><b>Estación:</b></p>
          <p>XAL-Xalostoc</p>
        </div>
        </div>
      </div>
      <div class="col s5">
        <img src="imagenes/mapa.png">
      </div>
    </div>
    <div class="row">
      <div class="col s12 ">
        <p>Parametros de la red</p>
      </div>
      <div class="col s5ths">
        <p>CO</p>
        <p>2652.07</p>
      </div>
      <div class="col s5ths">
        <p>NO</p>
        <p>456.07</p>
      </div>
      <div class="col s5ths">
        <p>N02</p>
        <p>2652.07</p>
      </div>
      <div class="col s5ths">
        <p>NOx</p>
        <p>456.07</p>
      </div>
      <div class="col s5ths">
        <p>O3</p>
        <p>2652.07</p>
      </div>
      <div class="col s5ths">
        <p>VV</p>
        <p>456.07</p>
      </div>
      <div class="col s5ths">
        <p>PM10</p>
        <p>2652.07</p>
      </div>
      <div class="col s5ths">
        <p>PM2.5</p>
        <p>456.07</p>
      </div>
      <div class="col s5ths">
        <p>S02</p>
        <p>2652.07</p>
      </div>
      <div class="col s5ths">
        <p>DV</p>
        <p>456.07</p>
      </div>
      <div class="col s5ths">
        <p>HR</p>
        <p>456.07</p>
      </div>
      <div class="col s5ths">
        <p>PB</p>
        <p>2652.07</p>
      </div>
      <div class="col s5ths">
        <p>PP</p>
        <p>456.07</p>
      </div>
      <div class="col s5ths">
        <p>RS</p>
        <p>2652.07</p>
      </div>
    </div>
  </div>

  <footer class="page-footer black">
    <div class="container">
      <div class="row">
        <div class="col l6 s12">
          <h5 class="white-text">datos.gob.mx</h5>
        </div>
        <div class="col l3 s12">

        </div>
        <div class="col l3 s12">
          <ul>
            <li><a class="white-text" href="#!">Datos</a></li>
            <li><a class="white-text" href="#!">Herramientas</a></li>
            <li><a class="white-text" href="#!">Blog</a></li>
            <li><a class="white-text" href="#!">Guía</a></li>
            <li><a class="white-text" href="#!">Consejo Consultivo</a></li>
            <li><a class="white-text" href="#!">Adela</a></li>
            <li><a class="white-text" href="#!">Acerca</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-copyright">
      <div class="container">
      LIBRE USO MX
      </div>
    </div>
  </footer>


  <!--  Scripts-->
  <script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
  <script src="js/materialize.js"></script>
  <script src="js/init.js"></script>
  <!-- <script type="text/javascript" src="./gaugeClient.js"></script>
		<script type="text/javascript" src="./labels.js"></script> -->
        <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
        <script type="text/javascript">
        var estaciones = [];
        var temporale = [];
        var avg = 0;
        var totalt = 0;

        $.ajax({
          type: 'GET',
          url: "https://api.datos.gob.mx/v1/sinaica?city=Pachuca&fecha=2017-06-29",
          data: {},
          success: function( data, textStatus, jqxhr ) {

            console.log('DATA');
            console.log(data.results);

            //for (var i = 0; i < data.results.length; i++) {

              //estaciones.push(data.results.stations[i].id);
              if(data.results[0]._id != "cve"){
                var contaminante = data.results[0].parametro;

                  if (contaminante == 'PM10'){
                    estaciones.push(parseFloat(data.results[0].valororig));
                  }

              }

            //}

            // for(var k = 0 ; k < estaciones.length; k++) {
            //     totalt += estaciones[k];
            // }
            console.log('PM10');
            console.log(contaminante);
            console.log('Total');
            console.log(data.results[0].valororig);
            //console.log(estaciones.length);
            //avg = totalt / estaciones.length;
            avg = data.results[0].valororig;
            console.log(avg);

            $('.contador').html(avg.toFixed(2));

          },
          xhrFields: {
            withCredentials: false
          },
          crossDomain: true,
          async:false
        });


var name = "Calidad del Aire";

var value = avg;


var gaugeMaxValue = 100;


// données à calculer
var percentValue = value / gaugeMaxValue;


////////////////////////

var needleClient;
var needleClient2;



(function(){

var barWidth, chart, chartInset, degToRad, repaintGauge,
height, margin, numSections, padRad, percToDeg, percToRad,
percent, radius, sectionIndx, svg, totalPercent, width,
valueText, formatValue, k;

percent = percentValue;

numSections = 1;
sectionPerc = 1 / numSections / 2;
padRad = 0.025;
chartInset = 10;

// Orientation of gauge:
totalPercent = .75;

el = d3.select('.chart-gauge');
el1 = d3.select('.chart-gauge1');
el2 = d3.select('.chart-gauge2');

margin = {
  top: 30,
  right: 30,
  bottom: 30,
  left: 30
};

width = el[0][0].offsetWidth - margin.left - margin.right;
height = width;
radius = Math.min(width, height) / 2;
barWidth = 40 * width / 300;



//Utility methods

percToDeg = function(perc) {
return perc * 360;
};

percToRad = function(perc) {
return degToRad(percToDeg(perc));
};

degToRad = function(deg) {
return deg * Math.PI / 180;
};

// Create SVG element
//svg = el.append('svg').attr('width', width + margin.left + margin.right).attr('height', height + margin.top + margin.bottom);
svg = el.append('svg').attr('width', width + margin.left + margin.right).attr('height', '220');

// Add layer for the panel
chart = svg.append('g').attr('transform', "translate(" + ((width) / 2 + margin.left) + ", " + ((height + margin.top) / 2) + ")");


chart.append('path').attr('class', "arc chart-first");
chart.append('path').attr('class', "arc chart-second");
chart.append('path').attr('class', "arc chart-third");
chart.append('path').attr('class', "arc chart-fourth");
chart.append('path').attr('class', "arc chart-fifth");

valueText = chart.append("text")
                .attr('id', "Value")
                .attr("font-size",16)
                .attr("text-anchor","middle")
                .attr("dy",".5em")
                .style("fill", '#000000');
//formatValue = d3.format('1%');
formatValue = d3.format(".2f");

arc5 = d3.svg.arc().outerRadius(radius - chartInset).innerRadius(radius - chartInset - barWidth)
arc4 = d3.svg.arc().outerRadius(radius - chartInset).innerRadius(radius - chartInset - barWidth)
arc3 = d3.svg.arc().outerRadius(radius - chartInset).innerRadius(radius - chartInset - barWidth)
arc2 = d3.svg.arc().outerRadius(radius - chartInset).innerRadius(radius - chartInset - barWidth)
arc1 = d3.svg.arc().outerRadius(radius - chartInset).innerRadius(radius - chartInset - barWidth)

repaintGauge = function ()
{
perc = 0.5;
var next_start = totalPercent;
arcStartRad = percToRad(next_start);
arcEndRad = arcStartRad + percToRad(perc / 5);
next_start += perc / 5;


arc1.startAngle(arcStartRad).endAngle(arcEndRad);

arcStartRad = percToRad(next_start);
arcEndRad = arcStartRad + percToRad(perc / 5);
next_start += perc / 5;

arc2.startAngle(arcStartRad + padRad).endAngle(arcEndRad);

arcStartRad = percToRad(next_start);
arcEndRad = arcStartRad + percToRad(perc / 5);
next_start += perc / 5;

arc3.startAngle(arcStartRad + padRad).endAngle(arcEndRad);

arcStartRad = percToRad(next_start);
arcEndRad = arcStartRad + percToRad(perc / 5);
next_start += perc / 5;

arc4.startAngle(arcStartRad + padRad).endAngle(arcEndRad);

arcStartRad = percToRad(next_start);
arcEndRad = arcStartRad + percToRad(perc / 5);

arc5.startAngle(arcStartRad + padRad).endAngle(arcEndRad);

chart.select(".chart-first").attr('d', arc1);
chart.select(".chart-second").attr('d', arc2);
chart.select(".chart-third").attr('d', arc3);
chart.select(".chart-fourth").attr('d', arc4);
chart.select(".chart-fifth").attr('d', arc5);

}
/////////

var dataset = [{metric:name, value: value}]

var texts = svg.selectAll("text")
            .data(dataset)
            .enter();

texts.append("text")
     .text(function(){
          return dataset[0].metric;
     })
     .attr('id', "Name")
     .attr('transform', "translate(" + ((width + margin.left) / 6) + ", " + ((height + margin.top) / 1.5) + ")")
     .attr("font-size",25)
     .style("fill", "#000000");


texts.append("text")
    .text(function(){
        return 0;
    })
    .attr('id', 'scale0')
    .attr('transform', "translate(" + ((width + margin.left) / 100 ) + ", " + ((height + margin.top) / 2) + ")")
    .attr("font-size", 15)
    .style("fill", "#000000");

texts.append("text")
    .text(function(){
        return gaugeMaxValue/2;
    })
    .attr('id', 'scale10')
    .attr('transform', "translate(" + ((width + margin.left) / 2.15 ) + ", " + ((height + margin.top) / 30) + ")")
    .attr("font-size", 15)
    .style("fill", "#000000");


texts.append("text")
    .text(function(){
        return gaugeMaxValue;
    })
    .attr('id', 'scale20')
    .attr('transform', "translate(" + ((width + margin.left) / 1.03 ) + ", " + ((height + margin.top) / 2) + ")")
    .attr("font-size", 15)
    .style("fill", "#000000");

var Needle = (function() {

//Helper function that returns the `d` value for moving the needle
var recalcPointerPos = function(perc) {
  var centerX, centerY, leftX, leftY, rightX, rightY, thetaRad, topX, topY;
  thetaRad = percToRad(perc / 2);
  centerX = 0;
  centerY = 0;
  topX = centerX - this.len * Math.cos(thetaRad);
  topY = centerY - this.len * Math.sin(thetaRad);
  leftX = centerX - this.radius * Math.cos(thetaRad - Math.PI / 2);
  leftY = centerY - this.radius * Math.sin(thetaRad - Math.PI / 2);
  rightX = centerX - this.radius * Math.cos(thetaRad + Math.PI / 2);
  rightY = centerY - this.radius * Math.sin(thetaRad + Math.PI / 2);

  return "M " + leftX + " " + leftY + " L " + topX + " " + topY + " L " + rightX + " " + rightY;
};

function Needle(el) {
  this.el = el;
  this.len = width / 2.5;
  this.radius = this.len / 8;
}

Needle.prototype.render = function() {
  this.el.append('circle').attr('class', 'needle-center').attr('cx', 0).attr('cy', 0).attr('r', this.radius);




  return this.el.append('path').attr('class', 'needle').attr('id', 'client-needle').attr('d', recalcPointerPos.call(this, 0));


};

Needle.prototype.moveTo = function(perc) {
  var self,
      oldValue = this.perc || 0;

  this.perc = perc;
  self = this;

  // Reset pointer position
  this.el.transition().delay(100).ease('quad').duration(200).select('.needle').tween('reset-progress', function() {
    return function(percentOfPercent) {
      var progress = (1 - percentOfPercent) * oldValue;

      repaintGauge(progress);
      return d3.select(this).attr('d', recalcPointerPos.call(self, progress));
    };
  });

  this.el.transition().delay(300).ease('bounce').duration(1500).select('.needle').tween('progress', function() {
    return function(percentOfPercent) {
      var progress = percentOfPercent * perc;
      //var progress = perc;

      repaintGauge(progress);

      var thetaRad = percToRad(progress / 2);
      var textX = - (self.len + 45) * Math.cos(thetaRad);
      var textY = - (self.len + 45) * Math.sin(thetaRad);

      valueText.text(formatValue(progress))
        .attr('transform', "translate("+textX+","+textY+")")

      return d3.select(this).attr('d', recalcPointerPos.call(self, progress));
    };
  });

};


return Needle;

})();

needle = new Needle(chart);
needle.render();
needle.moveTo(percent);

})();



// +++++++++++++++++++++++++++++++++ mapa ++++++++++++++++++++++++++++
  var mymap = L.map('mapid').setView([19.432608, -99.133209], 6);

	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
			'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery © <a href="http://mapbox.com">Mapbox</a>',
		id: 'mapbox.streets'
	}).addTo(mymap);

  if( /Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)){
    mymap.dragging.disable();
  }
  mymap.scrollWheelZoom.disable();
// +++++++++++++++++++++++++++++++++ fin mapa +++++++++++++++++++++++++
  </script>

  </body>
</html>
